<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>記事編集</title>
  <style>
    body {
      margin: 24px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 900px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px 10px;
      vertical-align: top;
    }
    th {
      background: #f7f7f7;
      text-align: left;
      width: 160px;
    }
    input, textarea {
      width: 100%;
      box-sizing: border-box;
    }
    textarea {
      height: 160px;
    }
    .flash {
      margin: 10px 0;
    }
    .flash-success {
      color: #0a7;
    }
    .flash-error {
      color: #c00;
    }
    .actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
  </style>
</head>
<body>
<h2>記事編集</h2>

<div class="flash">
  <p th:if="${message}" th:text="${message}" class="flash-success"></p>
  <p th:if="${error}" th:text="${error}" class="flash-error"></p>
</div>

<form method="post" th:object="${articleForm}">
  <table>
    <tbody>
    <tr>
      <th>タイトル</th>
      <td><input type="text" th:field="*{title}"></td>
    </tr>
    <tr>
      <th>本文</th>
      <td><textarea th:field="*{content}"></textarea></td>
    </tr>
    </tbody>
  </table>

  <!-- 通常更新 / 楽観ロック -->
  <div class="actions">
    <!-- 通常更新 -->
    <button type="submit"
            th:formaction="@{/articles/{id}(id=${articleId})}">
      更新する
    </button>

    <!-- 楽観ロック：速い更新 -->
    <button type="submit"
            th:formaction="@{/articles/{id}/update/fast(id=${articleId})}">
      楽観ロック：すぐに保存（fast）
    </button>

    <!-- 楽観ロック：遅い更新 -->
    <button type="submit"
            th:formaction="@{/articles/{id}/update/slow(id=${articleId})}">
      楽観ロック：ゆっくり保存（slow）
    </button>
  </div>

  <hr>

  <!-- 悲観ロック -->
  <div class="actions">
    <!-- 悲観ロック @Lock：速い -->
    <button type="submit"
            th:formaction="@{/articles/{id}/update/pessimistic/lock/fast(id=${articleId})}">
      悲観ロック（@Lock）：すぐに保存（fast）
    </button>

    <!-- 悲観ロック @Lock：遅い -->
    <button type="submit"
            th:formaction="@{/articles/{id}/update/pessimistic/lock/slow(id=${articleId})}">
      悲観ロック（@Lock）：ゆっくり保存（slow）
    </button>

    <!-- 悲観ロック @Query：速い -->
    <button type="submit"
            th:formaction="@{/articles/{id}/update/pessimistic/sql/fast(id=${articleId})}">
      悲観ロック（@Query）：すぐに保存（fast）
    </button>

    <!-- 悲観ロック @Query：遅い -->
    <button type="submit"
            th:formaction="@{/articles/{id}/update/pessimistic/sql/slow(id=${articleId})}">
      悲観ロック（@Query）：ゆっくり保存（slow）
    </button>
  </div>
</form>

<p><a th:href="@{/articles}">← 一覧に戻る</a></p>
</body>
</html>