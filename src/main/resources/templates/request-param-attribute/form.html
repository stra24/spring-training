<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>@RequestParam 動作確認（属性）フォーム画面</title>

  <style>
    body {
      margin: 16px;
      line-height: 1.6;
    }

    .box {
      border: 1px solid #ddd;
      padding: 12px;
      margin: 12px 0;
    }

    .links a {
      margin-right: 8px;
    }

    input {
      margin-left: 6px;
    }

    button {
      margin-left: 8px;
    }
  </style>
</head>

<body>
<h1>@RequestParam 動作確認（属性）フォーム画面</h1>

<p>
  ✅…成功（200系）／❌…失敗（例外名とHTTPコード）<br>
  <strong>未指定</strong>は、入力欄をHTMLから消すか、下の「未指定」リンクを利用。<br>
  入力を空で送信すると <code>?x=</code>（空文字）。
</p>

<h2>required属性のテスト</h2>

<section class="box">
  <h3>1) required=true × String</h3>

  <form th:action="@{/request-param-attribute/req-true-string}" method="get">
    <label>x: <input name="x"></label>
    <button>送信</button>
  </form>

  <div class="links">
    <a th:href="@{/request-param-attribute/req-true-string}">未指定</a>
    <a th:href="@{/request-param-attribute/req-true-string(x='')}">空文字</a>
    <a th:href="@{/request-param-attribute/req-true-string(x=1)}">数値</a>
    <a th:href="@{/request-param-attribute/req-true-string(x='abc')}">文字</a>
  </div>

  <details>
    <summary>挙動</summary>
    <ul>
      <li>未指定：❌ MissingServletRequestParameterException（400）</li>
      <li>空文字：✅ ""</li>
      <li>数値：✅ "1"</li>
      <li>文字：✅ "abc"</li>
    </ul>
  </details>
</section>

<section class="box">
  <h3>2) required=false × String</h3>

  <form th:action="@{/request-param-attribute/req-false-string}" method="get">
    <label>x: <input name="x"></label>
    <button>送信</button>
  </form>

  <div class="links">
    <a th:href="@{/request-param-attribute/req-false-string}">未指定</a>
    <a th:href="@{/request-param-attribute/req-false-string(x='')}">空文字</a>
    <a th:href="@{/request-param-attribute/req-false-string(x=1)}">数値</a>
    <a th:href="@{/request-param-attribute/req-false-string(x='abc')}">文字</a>
  </div>

  <details>
    <summary>挙動</summary>
    <ul>
      <li>未指定：✅ null</li>
      <li>空文字：✅ ""</li>
      <li>数値：✅ "1"</li>
      <li>文字：✅ "abc"</li>
    </ul>
  </details>
</section>

<section class="box">
  <h3>3) required=true × int</h3>

  <form th:action="@{/request-param-attribute/req-true-int}" method="get">
    <label>x: <input name="x"></label>
    <button>送信</button>
  </form>

  <div class="links">
    <a th:href="@{/request-param-attribute/req-true-int}">未指定</a>
    <a th:href="@{/request-param-attribute/req-true-int(x='')}">空文字</a>
    <a th:href="@{/request-param-attribute/req-true-int(x=1)}">数値</a>
    <a th:href="@{/request-param-attribute/req-true-int(x='abc')}">文字</a>
  </div>

  <details>
    <summary>挙動</summary>
    <ul>
      <li>未指定：❌ MissingServletRequestParameterException（400）</li>
      <li>空文字：❌ MethodArgumentTypeMismatchException（400）</li>
      <li>数値：✅ 1</li>
      <li>文字：❌ MethodArgumentTypeMismatchException（400）</li>
    </ul>
  </details>
</section>

<section class="box">
  <h3>4) required=false × int（危険）</h3>

  <form th:action="@{/request-param-attribute/req-false-int}" method="get">
    <label>x: <input name="x"></label>
    <button>送信</button>
  </form>

  <div class="links">
    <a th:href="@{/request-param-attribute/req-false-int}">未指定</a>
    <a th:href="@{/request-param-attribute/req-false-int(x='')}">空文字</a>
    <a th:href="@{/request-param-attribute/req-false-int(x=1)}">数値</a>
    <a th:href="@{/request-param-attribute/req-false-int(x='abc')}">文字</a>
  </div>

  <details>
    <summary>挙動</summary>
    <ul>
      <li>未指定：❌ IllegalStateException（500）</li>
      <li>空文字：❌ MethodArgumentTypeMismatchException（400）</li>
      <li>数値：✅ 1</li>
      <li>文字：❌ MethodArgumentTypeMismatchException（400）</li>
    </ul>
  </details>
</section>

<section class="box">
  <h3>5) required=true × Integer</h3>

  <form th:action="@{/request-param-attribute/req-true-integer}" method="get">
    <label>x: <input name="x"></label>
    <button>送信</button>
  </form>

  <div class="links">
    <a th:href="@{/request-param-attribute/req-true-integer}">未指定</a>
    <a th:href="@{/request-param-attribute/req-true-integer(x='')}">空文字</a>
    <a th:href="@{/request-param-attribute/req-true-integer(x=1)}">数値</a>
    <a th:href="@{/request-param-attribute/req-true-integer(x='abc')}">文字</a>
  </div>

  <details>
    <summary>挙動</summary>
    <ul>
      <li>未指定：❌ MissingServletRequestParameterException（400）</li>
      <li>空文字：❌ MissingServletRequestParameterException（400）</li>
      <li>数値：✅ 1</li>
      <li>文字：❌ MethodArgumentTypeMismatchException（400）</li>
    </ul>
  </details>
</section>

<section class="box">
  <h3>6) required=false × Integer（安全）</h3>

  <form th:action="@{/request-param-attribute/req-false-integer}" method="get">
    <label>x: <input name="x"></label>
    <button>送信</button>
  </form>

  <div class="links">
    <a th:href="@{/request-param-attribute/req-false-integer}">未指定</a>
    <a th:href="@{/request-param-attribute/req-false-integer(x='')}">空文字</a>
    <a th:href="@{/request-param-attribute/req-false-integer(x=1)}">数値</a>
    <a th:href="@{/request-param-attribute/req-false-integer(x='abc')}">文字</a>
  </div>

  <details>
    <summary>挙動</summary>
    <ul>
      <li>未指定：✅ null</li>
      <li>空文字：✅ null</li>
      <li>数値：✅ 1</li>
      <li>文字：❌ MethodArgumentTypeMismatchException（400）</li>
    </ul>
  </details>
</section>

<section class="box">
  <h3>7) Optional&lt;String&gt;</h3>

  <form th:action="@{/request-param-attribute/optional-string}" method="get">
    <label>x: <input name="x"></label>
    <button>送信</button>
  </form>

  <div class="links">
    <a th:href="@{/request-param-attribute/optional-string}">未指定</a>
    <a th:href="@{/request-param-attribute/optional-string(x='')}">空文字</a>
    <a th:href="@{/request-param-attribute/optional-string(x=1)}">数値</a>
    <a th:href="@{/request-param-attribute/optional-string(x='abc')}">文字</a>
  </div>

  <details>
    <summary>挙動</summary>
    <ul>
      <li>未指定：✅ Optional.empty()</li>
      <li>空文字：✅ Optional.of("")</li>
      <li>数値：✅ Optional.of("1")</li>
      <li>文字：✅ Optional.of("abc")</li>
    </ul>
  </details>
</section>

<hr>

<h2>value / name / defaultValue属性のテスト</h2>

<section class="box">
  <h3>8) パラメータ名を明示指定（value / name）</h3>

  <form th:action="@{/request-param-attribute/param-name-explicit}" method="get">
    <label>q: <input name="q" placeholder="例: Hello"></label>
    <button>送信</button>
  </form>

  <div class="links">
    <a th:href="@{/request-param-attribute/param-name-explicit(q='Hello')}">q=Hello</a>
    <a th:href="@{/request-param-attribute/param-name-explicit(q='')}">q=（空文字）</a>
  </div>

  <details>
    <summary>挙動</summary>
    <ul>
      <li>@RequestParam("q") と @RequestParam(name="q") は同じ</li>
    </ul>
  </details>
</section>

<section class="box">
  <h3>9) 省略時は引数名がパラメータ名になる</h3>

  <form th:action="@{/request-param-attribute/param-name-default}" method="get">
    <label>search: <input name="search" placeholder="例: Java"></label>
    <button>送信</button>
  </form>

  <div class="links">
    <a th:href="@{/request-param-attribute/param-name-default(search='Java')}">search=Java</a>
    <a th:href="@{/request-param-attribute/param-name-default(search='')}">search=（空文字）</a>
  </div>

  <details>
    <summary>挙動</summary>
    <ul>
      <li>value/name を省略すると引数名が使われます（この例は search）</li>
    </ul>
  </details>
</section>

<section class="box">
  <h3>10) defaultValue（String / Integer / Optional）</h3>

  <form th:action="@{/request-param-attribute/default-matrix}" method="get">
    <div>
      <label>user: <input name="user" placeholder="未指定/空文字で guest"></label>
    </div>
    <div>
      <label>page: <input name="page" placeholder="未指定/空文字で 1"></label>
    </div>
    <div>
      <label>kw: <input name="kw" placeholder="未指定/空文字で &quot;&quot;"></label>
    </div>
    <button>送信</button>
  </form>

  <div class="links">
    <a th:href="@{/request-param-attribute/default-matrix}">未指定</a>
    <a th:href="@{/request-param-attribute/default-matrix(user='',page='',kw='')}">空文字</a>
    <a th:href="@{/request-param-attribute/default-matrix(user=' ',kw=' ')}">スペース1文字</a>
    <a th:href="@{/request-param-attribute/default-matrix(page='abc')}">page=abc</a>
  </div>

  <details>
    <summary>挙動</summary>
    <ul>
      <li>未指定/空文字：defaultValue が適用</li>
      <li>スペース1文字：空文字ではないので defaultValue は使われない</li>
      <li>page=abc：❌ 400（Integer 変換不可）</li>
    </ul>
  </details>
</section>

<section class="box">
  <h3>11) required=true + defaultValue + int</h3>

  <form th:action="@{/request-param-attribute/required-and-default}" method="get">
    <label>page: <input name="page" placeholder="未指定でも 10"></label>
    <button>送信</button>
  </form>

  <div class="links">
    <a th:href="@{/request-param-attribute/required-and-default}">未指定</a>
    <a th:href="@{/request-param-attribute/required-and-default(page='')}">空文字</a>
    <a th:href="@{/request-param-attribute/required-and-default(page=5)}">page=5</a>
    <a th:href="@{/request-param-attribute/required-and-default(page='abc')}">page=abc</a>
  </div>

  <details>
    <summary>挙動</summary>
    <ul>
      <li>未指定/空文字：✅ 10（defaultValue）</li>
      <li>page=abc：❌ 400（型不一致）</li>
      <li>defaultValue を付けると required は実質無視されます</li>
    </ul>
  </details>
</section>
</body>
</html>
